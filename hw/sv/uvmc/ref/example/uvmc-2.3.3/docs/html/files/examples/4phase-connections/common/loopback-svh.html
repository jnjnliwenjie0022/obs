<html><head><title>Description of SV loopback module</title><link rel="stylesheet" type="text/css" href="../../../../styles/main.css"><script language=JavaScript src="../../../../javascript/main.js"></script></head><body class="FramedContentPage" onLoad="NDOnLoad()"><script language=JavaScript><!--
if (browserType) {document.write("<div class=" + browserType + ">");if (browserVer) {document.write("<div class=" + browserVer + ">"); }}// --></script>

<!--  Generated by Natural Docs, version Development Release 01-12-2008 (1.35 base) -->
<!--  http://www.naturaldocs.org  -->

<!-- saved from url=(0026)http://www.naturaldocs.org --> 








 <!--TOP - START OF CONTENT-->
<div id=Content>


 <!--CONTENT index=0 -->
<div class="CSection"><div class=CTopic id=MainTopic><h1 class=CTitle><a name="Description_of_SV_loopback_module" href="../../../../uvmc/examples/4phase.connections/common/loopback.svh">Description of SV loopback module</a></h1><div class=CBody><p>This module implements the <i>SV loopback</i> side of the diagram you saw in <i>producer_loopback.h</i>.</p><p>Its job is to play a 4-phase protocol on its <i>in</i> target socket and to play a 2-phase protocol on its <i>out</i> initiator socket as described in <i>producer_loopback.h</i>.</p><p>The <i>in</i> socket exports the <i>uvm_tlm_nb_target_socket</i> interface implemented by this loopback.</p><p>The <i>out</i> socket exports the <i>uvm_tlm_b_initiator_socket</i> interface used by this loopback.</p><p>The <i>run_phase()</i> method is the workhorse thread that performs the loopback operation itself.</p><p>It waits until it is notified that it got a transaction from the <i>nb_transport_fw()</i> callback for the <i>in</i> target.&nbsp; This completes the REQ phase of the 4-phase protocol.</p><p>It then mirrors that <i>savedTrans</i> transaction ref back to the initiator port by calling its <i>b_transport()</i> callin.&nbsp; When this function returns it finally sends the transaction back over the backward path of the target port by calling its <i>nb_transport_bw()</i> to complete the RESP phase.</p><p>Again it is expected that the same <i>savedTrans</i> ref is passed via the backward path during this phase in order to ensure transaction preservation back on the producer side.</p><blockquote><pre>import uvm_pkg::*;
`include &quot;uvm_macros.svh&quot;

class loopback extends uvm_component;

   uvm_tlm_nb_target_socket #(loopback) in;
   uvm_tlm_b_initiator_socket #() out;

   `uvm_component_utils(loopback)

    local uvm_tlm_gp savedTrans;
    event gotTransEvent;

   function new(string name, uvm_component parent=null);
      super.new(name,parent);
      in = new(&quot;in&quot;,  this);
      out = new(&quot;out&quot;,  this);
   endfunction

    // task called via 'in' socket
    virtual function uvm_tlm_sync_e nb_transport_fw(
        uvm_tlm_gp trans, ref uvm_tlm_phase_e phase, input uvm_tlm_time delay );

        phase = END_REQ;
        trans.set_response_status( UVM_TLM_OK_RESPONSE );
        savedTrans = trans;
        -&gt;gotTransEvent;

        return UVM_TLM_UPDATED;
    endfunction

    task run_phase( uvm_phase phase );
        uvm_tlm_sync_e result;
        uvm_tlm_phase_e nbt_phase = BEGIN_RESP;
        uvm_tlm_time delay = new(&quot;del&quot;,1e-9);

        forever begin
            @gotTransEvent;

            out.b_transport( savedTrans, delay );

            #10ns;

            result = in.nb_transport_bw( savedTrans, nbt_phase, delay );
            if( result != UVM_TLM_COMPLETED || nbt_phase != END_RESP
                    || savedTrans.get_response_status() != UVM_TLM_OK_RESPONSE )
                `uvm_error( &quot;loopback::run_phase()&quot;,
                    &quot;Unexpected response from call to out.nb_transport_bw()&quot; );
        end
    endtask
endclass</pre></blockquote>

<!--START_ND_SUMMARY index=0-->
<div class=Summary><div class=STitle>Summary</div><div class=SBorder><table border=0 cellspacing=0 cellpadding=0 class=STable>
  <!-- index=0 -->

<tr class="SMain"><td colspan=2 class=SEntry><a href="#Description_of_SV_loopback_module" >Description of SV loopback module</a></td></tr>
<tr class=SMain><td colspan=2 class=SWideDescription>This module implements the <i>SV loopback</i> side of the diagram you saw in <i>producer_loopback.h</i>.</td></tr></table></div></div><!--END_ND_SUMMARY-->
</div></div></div>

</div><!--Content-->



<!--START_ND_TOOLTIPS-->
<!--END_ND_TOOLTIPS-->

<script language=JavaScript><!--
if (browserType) {if (browserVer) {document.write("</div>"); }document.write("</div>");}// --></script></body></html>